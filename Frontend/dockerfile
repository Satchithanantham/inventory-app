
# ---- Build stage ----
FROM node:18-alpine AS build
WORKDIR /app

# Copy manifest files first; works with or without package-lock.json
COPY package*.json ./

# If lockfile exists, use npm ci; otherwise use npm install
RUN if [ -f package-lock.json ]; then npm ci; else npm install; fi

# Copy the rest of the source and build
COPY . .
RUN npm run build

# ---- Runtime stage ----
FROM nginx:alpine
# Copy compiled static assets to NGINX default html directory
COPY --from=build /app/build /usr/share/nginx/html

# Copy NGINX config (SPA + API proxy)
COPY nginx.conf /etc/nginx/conf.d/default.conf


# (Optional) add custom nginx.conf if needed for SPA routing or proxies
# COPY nginx.conf /etc/nginx/conf.d/default.conf

EXPOSE 80
CMD ["nginx", "-g", "daemon off;"]
